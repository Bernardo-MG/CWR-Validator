<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validation results</title>
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}">
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/style.css') }}">
    <script
	  src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/cwr.js') }}"></script>
  </head>
  <body>
    <div id="wrapper" class="container">
        <div id="header">
			<div class="page-header">
	            <h1>Validator <small>CWR document validator</small></h1>
            </div>
		</div>
		<div id="header_menu">
            <div class="navbar navbar-inverse" role="navigation">
	            <div class="navbar-header">
		            <button type="button" class="navbar-toggle" data-toggle="collapse"
			            data-target="#bs-example-navbar-collapse-1">
			            <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span>
			            <span class="icon-bar"></span> <span class="icon-bar"></span>
		            </button>
		            <a class="navbar-brand" href="/">Home</a>
	               </div>
	            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		            <ul class="nav navbar-nav">
			            <li><a href="/upload">Upload file</a></li>
				        <!-- <li><a href="#">View results</a></li> -->
		            </ul>
	            </div>
            </div>
		</div>
        <div id="content">
          {% if document._rejected %}
            <h2>Document has been rejected</h2>
            <p>Reason: {{ document._rejected_reason}}</p>
          {% else %}
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li class="active"><a href="#summary" data-toggle="tab">Summary</a></li>
              <li><a href="#agreements" data-toggle="tab">Agreements</a></li>
              <li><a href="#new-works" data-toggle="tab">New registrations</a></li>
              <li><a href="#rev-works" data-toggle="tab">Revisions</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="summary">
                  <dl>
                    <dt>Document name</dt>
                    <dd> {{ document._name }} </dd>
                    <dt>Records found</dt>
                    <dd> {{ document._records_number}} </dd>
                    <dt>Transactions found</dt>
                    <dd>{{ document._transactions_number }}</dd>
                    <dt>Successful transactions</dt>
                    <dd>{{ document.transactions|length }}</dd>
                    <dt>Successful records</dt>
                    <dd> {{ 2 + document._group_types|length + document.transactions|length + document._record_errors|length + document._transaction_errors|length}} </dd>
                    <dt>Missed transactions</dt>
                    <dd> {{ document._transaction_errors|length }} </dd>
                    <dt>Missed records</dt>
                    <dd> {{ document._record_errors|length }} </dd>
                    <dt>Document header</dt>
                    <dd> {{ document._transmission_header._record }} </dd>
                    <dt>Document trailer</dt>
                    <dd> {{ document._transmission_trailer._record }} </dd>
                  </dl>
                  <p><a class="btn btn-primary disabled" role="button" href="#">Download generated response</a></p>
                </div>
                <div class="tab-pane" id="agreements">
                  {% for transaction in document._transactions.values() %}
                  {% if transaction.attr_dict['Record prefix'].record_type == 'AGR' %}
                      {% if transaction._rejected %}
                        <div class="panel-heading bg-danger">
                        {{ transaction._record }}
                        </div>
                        <div class="panel-body">
                        {{ document._transaction_errors[transaction.attr_dict['Record prefix'].transaction_number] }}
                        </div>
                      {% else %}
                        <div class="panel-heading bg-success">
                        {{ transaction._record }}
                        </div>
                      {% endif %}
                      <ul class="list-group">
                          {% for record_list in transaction._records.values() %}
                            {% for record in record_list %}
                              {% if record._rejected %}
                                <li class="list-group-item bg-danger">{{ record.record }}</li>
                                <li class="list-group-item">
                                    {{ document._record_errors[record.attr_dict['Record prefix'].record_number] }}
                                </li>
                              {% else %}
                                <li class="list-group-item bg-success">{{ record.record }}</li>
                              {% endif %}
                            {% endfor %}
                          {% endfor %}
                      </ul>
                    {% endif %}
                    {% endfor %}
                </div>
                <div class="tab-pane" id="new-works">
                  {% for transaction in document._transactions.values() %}
                  {% if transaction.attr_dict['Record prefix'].record_type == 'NWR' %}
                      {% if transaction._rejected %}
                        <div class="panel-heading bg-danger">
                            {{ transaction._record }}
                        </div>
                        <div class="panel-body">
                        {{ document._transaction_errors[transaction.attr_dict['Record prefix'].transaction_number] }}
                        </div>
                      {% else %}
                        <div class="panel-heading bg-success">
                        {{ transaction._record }}
                        </div>
                      {% endif %}
                      <div class="panel-body">
                      </div>
                      <ul class="list-group">
                          {% for record_list in transaction._records.values() %}
                            {% for record in record_list %}
                              {% if record._rejected %}
                                <li class="list-group-item bg-danger">{{ record.record }}</li>
                                <li class="list-group-item">
                                    {{ document._record_errors[record.attr_dict['Record prefix'].record_number] }}
                                </li>
                              {% else %}
                                <li class="list-group-item bg-success">{{ record.record }}</li>
                              {% endif %}
                            {% endfor %}
                          {% endfor %}
                      </ul>
                    {% endif %}
                    {% endfor %}
                </div>
                <div class="tab-pane" id="rev-works">
                  {% for transaction in document._transactions.values() %}
                  {% if transaction.attr_dict['Record prefix'].record_type == 'REV' %}
                      {% if transaction._rejected %}
                        <div class="panel-heading bg-danger">
                        {{ transaction._record }}
                        </div>
                        <div class="panel-body">
                        {{ document._transaction_errors[transaction.attr_dict['Record prefix'].transaction_number] }}
                        </div>
                      {% else %}
                        <div class="panel-heading bg-success">
                        {{ transaction._record }}
                        </div>
                      {% endif %}
                      <div class="panel-body">
                      </div>
                      <ul class="list-group">
                          {% for record_list in transaction._records.values() %}
                            {% for record in record_list %}
                              {% if record._rejected %}
                                <li class="list-group-item bg-danger">{{ record.record }}</li>
                                <li class="list-group-item">
                                    {{ document._record_errors[record.attr_dict['Record prefix'].record_number] }}
                                </li>
                              {% else %}
                                <li class="list-group-item bg-success">{{ record.record }}</li>
                              {% endif %}
                            {% endfor %}
                          {% endfor %}
                      </ul>
                    {% endif %}
                    {% endfor %}
                </div>
            {% endif %}
            </div>
        </div>
      </div>
  </body>
</html>